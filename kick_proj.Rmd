---
title: "Can you kickstart?"
author: "JG"
date: "2/10/2022"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Data Prep & Review ##############################################################################################################

```{r Load Libraries}
library(tidyverse)
library(lubridate)
library(ggplot2)
library(gridExtra)

```

```{r Load Data}

#### Load data from file ------------------------------------------------------

ks_b <- read.csv('Kickstarter_Campaigns_DataSet.csv')
head(ks_b)
str(ks_b)
summary(ks_b)


#### Filter and Column Formatting ------------------------------------------------------

ks <- ks_b %>% 
  #remove projects with goal under 1$
  filter(goal_usd>1) %>%
  #filter for completed projects only
  filter(status=='successful'|status=='failed') %>%
  #format date strings into date class
  mutate(launched_at=mdy_hm(launched_at)) %>%
  mutate(deadline=mdy_hm(deadline)) %>%
  #extract elements from launch date and deadline
  mutate(launch_year=year(launched_at)) %>% 
  mutate(launch_month=month(launched_at)) %>%
  mutate(launch_dom=day(launched_at)) %>%
  mutate(launch_dow=wday(launched_at)) %>%
  mutate(launch_hour=hour(launched_at)) %>%
  mutate(dead_year=year(deadline)) %>% 
  mutate(dead_month=month(deadline)) %>% 
  mutate(dead_dom=day(deadline)) %>% 
  mutate(dead_dow=wday(deadline)) %>%
  mutate(dead_hour=hour(deadline)) %>% 
  #calculate percent funded
  mutate(pct_funded=usd_pledged/goal_usd) %>%
  #calculates average pledge amount
  mutate(avg_plg.bkr=ifelse(backers_count > 0,usd_pledged/backers_count,0)) %>%
  #name counts
  mutate(name_len=str_length(name)) %>%
  mutate(name_wrd=sapply(strsplit(name," "),length)) %>%
  #binary status field for modeling
  mutate(status_binary=ifelse(status=='successful',1,0)) %>%
  #outlier filter, see below
  filter(backers_count<=3997) %>%
  filter(goal_usd<=5e05) %>%
  filter(avg_plg.bkr<=724)

summary(ks)
#no null values in any field

```

## Evaluate For Outliers ########################################################################################
Try to determine if outliers exist for numerical fields

Reviewed several sources for outlier detection in data, few were useful
- data not normally distributed, z-scre method not applicable {https://machinelearningmastery.com/how-to-use-statistics-to-identify-outliers-in-data/}
- advanced methods were too challenging to implement {https://www.itl.nist.gov/div898/handbook/eda/section3/eda35h.htm},etc
- most evaluated using IQR method when possible (3x) {https://machinelearningmastery.com/how-to-use-statistics-to-identify-outliers-in-data/}
- when no methods applied (IQR method removes too much data), eliminated top 0.05% as extreme outliers

- suggest revisiting analysis after receiving feedback

```{r outliers}
summary(ks)

#--- backers_count -------------------------------------------------------------------
summary(ks$backers_count)
# Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
#  0.0      5.0     32.0    167.7    102.0 105857.0 
###
#huge gap between IQR and max suggests outlier


#the difference is significant for both outcomes, but two orders of magnitude greater for successful
ks %>% 
  select(status,backers_count) %>%
  split(.$status) %>%
  map(summary)
# $failed
#     status          backers_count    
#  Length:76432       Min.   :   0.00  
#  Class :character   1st Qu.:   1.00  
#  Mode  :character   Median :   3.00  
#                     Mean   :  11.71  
#                     3rd Qu.:   9.00  
#                     Max.   :4435.00  
# 
# $successful
#     status          backers_count     
#  Length:126135      Min.   :     1.0  
#  Class :character   1st Qu.:    33.0  
#  Mode  :character   Median :    73.0  
#                     Mean   :   262.3  
#                     3rd Qu.:   173.0  
#                     Max.   :105857.0 

#plots confirm there are clearly outliers
ks %>%
  ggplot(aes(x=backers_count)) +
  geom_histogram()

ks %>%
  ggplot(aes(y=backers_count,x=status)) +
  geom_boxplot()

# consider IQR: Q3x3
ks %>% count()
ks %>% filter(backers_count<=102*3) %>% count()
184124/202567 #removes ~10% of data, too much to be considered outliers

# considered other statistical methods such as {https://www.itl.nist.gov/div898/handbook/eda/section3/eda35h.htm}
# too complicated - try slicing off top .05%
# note - the actual filter will remove based on a value, not percentage, to prevent cascading effects of slicing percent for each variable

ks %>% slice_min(backers_count,prop = .995) %>% summarize(max(backers_count)) #3997
ks %>% filter(backers_count<=3997) %>%
  ggplot(aes(x=backers_count)) +
  geom_histogram(aes(fill=status),alpha=.7,position=position_dodge(20))
#looks much more reasonable

ks %>% filter(backers_count<=3997) %>%
  ggplot(aes(y=backers_count,x=status)) +
  geom_boxplot(aes(fill=status))


#--- usd_pledged -------------------------------------------------------------------

# the point of this analysis is to determine what factors influence success
# usd_pledged on it's own fails to help answer this question directly in a meaningful way
# it either exceeds goal_usd (success) or does not (failure) or provide deep insights
# into why a project failed besides 'didn't get enough money'

#expecting this will be captured when looking at outliers fore pledge/bkr and pct_funded

#--- goal_usd -------------------------------------------------------------------

summary(ks$goal_usd)

ks %>%
  ggplot(aes(x=goal_usd)) +
  geom_histogram()

ks %>%
  ggplot(aes(y=goal_usd,x=status)) +
  geom_boxplot()

#IQRx3 not viable
ks %>% count()
ks %>% filter(goal_usd<=12000*3) %>% count()
184518/202567 #removes ~9% of data, too much to be considered outliers

#shave off top 0.05%
ks %>% slice_min(goal_usd,prop = .995) %>% summarize(max(goal_usd)) #5e05
ks %>% filter(goal_usd<=5e05) %>%
  ggplot(aes(x=goal_usd)) +
  geom_histogram(aes(fill=status),alpha=.7,position=position_dodge(20))

ks %>% filter(goal_usd<=5e05) %>%
  ggplot(aes(y=goal_usd,x=status)) +
  geom_boxplot(aes(fill=status))

#--- duration -------------------------------------------------------------------

ks %>%
  ggplot(aes(x=duration)) +
  geom_histogram()

ks %>%
  ggplot(aes(y=duration,x=status)) +
  geom_boxplot()

#possible outliers, consider IQR
ks %>% count()
ks %>% filter(duration<=35*3) %>% count()
202567/202567 #removes no data, filter not applied

#--- pct_funded -------------------------------------------------------------------











#Revisit?











#--- avg_plg.bkr -------------------------------------------------------------------

ks %>%
  ggplot(aes(x=avg_plg.bkr)) +
  geom_histogram()

ks %>%
  ggplot(aes(y=avg_plg.bkr,x=status)) +
  geom_boxplot()

#possible outliers, consider IQR
ks %>% count()
ks %>% filter(avg_plg.bkr<=86.19*3) %>% count()
194954/202567 #removes ~4% of data, too much

#shave off top 0.05%
ks %>% slice_min(avg_plg.bkr,prop = .995) %>% summarize(max(avg_plg.bkr)) #723.603

ks %>% filter(avg_plg.bkr<=724) %>%
  ggplot(aes(x=avg_plg.bkr)) +
  geom_histogram(aes(fill=status),alpha=.7,position=position_dodge(20))

ks %>% filter(avg_plg.bkr<=724) %>%
  ggplot(aes(y=avg_plg.bkr,x=status)) +
  geom_boxplot(aes(fill=status))

```

```{r Outliers filter}

#based on values identified in previous chunk
#this has been replicated above so I don't forget to run it

ks <- ks %>% 
  filter(backers_count<=3997) %>%
  filter(goal_usd<=5e05) %>%
  filter(avg_plg.bkr<=724)
  


```


## EDA #######################################################################################################################


```{r name}

#--- name length ---------------------------------------------------------------
ks %>%
  ggplot(aes(x=name_len, col=status)) +
  geom_density()
#if this trend is real...interesting

ks %>%
  ggplot(aes(x=name_len, fill=status)) +
  geom_histogram(position=position_dodge(1.7),alpha=1,col='grey3') +
  theme_classic()
# confirmed via histogram

ks %>%
  ggplot() +
  geom_point(aes(y=log(goal_usd),x=name_len,col=status), size=.01)

# name length, count of each, scale size bu pct success

#--- name length x success w/ goal ----

ks %>%
  group_by(name_len) %>%
  summarize(n(),
            avg_goal=mean(goal_usd),
            avg_backers=mean(backers_count),
            succ_rate=sum(status=='successful')/n()) %>%
  ggplot() +
  geom_point(aes(x=name_len,y=succ_rate,size=avg_goal,color=avg_backers)) +
  labs(title='Name Length vs Project Success',x='Characters in Name',y='Success Rate',
       size="Average Goal USD", color="Average Backer Count") +
  theme_linedraw()
  #there appears to be a sweet spot for name length - 40-60 characters
  #right side of graph may be due to low sample size, plot color as density


#USE THIS
ks %>%
  group_by(name_len) %>%
  summarize(total=n(),
            avg_goal=mean(goal_usd),
            avg_backers=mean(backers_count),
            succ_rate=sum(status=='successful')/n()) %>%
  ggplot() +
  geom_point(aes(x=name_len,y=succ_rate,size=avg_goal,color=total)) +
  geom_hline(yintercept = sum(ks$status=='successful')/sum((ks$status=='successful'|ks$status=='failed')))+
  labs(title='Name Length vs Project Success',x='Characters in Name',y='Success Rate',
       size="Average Goal USD", color="Count") +
  theme_linedraw() +
  scale_color_gradient(low='grey',high='firebrick4') +
  scale_x_continuous(breaks=seq(0,90,by=5))


#--- name word ---------------------------------------------------------------
ks %>%
  ggplot(aes(x=name_wrd, col=status)) +
  geom_density() +
 scale_x_continuous(limits=c(0,40),breaks=seq(0,40)) 
#lol fake, just density plot being dumb

ks %>%
  ggplot(aes(x=name_wrd, fill=status)) +
  geom_histogram(alpha=.5,position=position_dodge(.7))
# similar trends, tons more at length 7

ks %>%
  group_by(name_wrd) %>%
  summarize(total=n(),
            avg_goal=mean(goal_usd),
            avg_backers=mean(backers_count),
            succ_rate=sum(status=='successful')/n()) %>%
  ggplot() +
  geom_point(aes(x=name_wrd,y=succ_rate,size=avg_goal,color=total)) +
  theme_linedraw()
  #same as above, count seems more important that backer count


ks %>%
  group_by(name_wrd) %>%
  summarize(total=n(),
            avg_goal=mean(goal_usd),
            avg_backers=mean(backers_count),
            succ_rate=sum(status=='successful')/n()) %>%
  ggplot() +
  geom_point(aes(x=name_wrd,y=succ_rate,size=avg_goal,color=total)) +
  labs(title='Name Word Count vs Project Success',x='Words in Name',y='Success Rate',
       size="Average Goal USD", color="Count") +
  theme_linedraw() +
  scale_color_gradient(low='grey',high='firebrick4')


#--- name word*char ---------------------------------------------------------------


ks %>%
  ggplot(aes(x=name_len,y=name_wrd)) + 
  geom_point(aes(color=status),size=1)


#USE THIS
ks %>%
  ggplot(aes(x=name_len/name_wrd)) + 
  geom_density(aes(fill=status),alpha=.4) +
  theme_linedraw()+
  labs(title='Average Word Length',x='Chars in Word',y='Density') +  
  xlim(0,20)

ks %>% group_by(status) %>% summarize(mean(name_len/name_wrd))
#  status     `mean(name_len/name_wrd)`
#   <chr>                          <dbl>
# 1 failed                          6.48
# 2 successful                      6.20
##
#average name length for projects is 6.3

```


```{r currency & country}
## currency -------------------------------------------------------------

ks %>% 
  group_by(currency) %>% 
  summarize(total=n(), succ_rate=sum(status=='successful')/total) %>%
  ggplot(aes(x=currency,y=succ_rate)) +
  geom_point(aes(size=total)) +
  ylim(0,1)


## country -------------------------------------------------------------

ks %>% 
  group_by(country) %>% 
  summarize(total=n(), succ_rate=sum(status=='successful')/total) %>%
  ggplot(aes(x=country,y=succ_rate)) +
  geom_point(aes(size=total)) +
  theme_linedraw() +
  ylim(0,1)

#country and currency seem to track pretty closely - report just one?
cor(ks$country, ks$currency)
#need to convert to numbers
unq_ctry <- data.frame(country=unique(ks$country),country_code=seq(1:length(unique(ks$country))))
unq_ctry
unq_curr <- data.frame(currency=unique(ks$currency),currency_code=seq(1:length(unique(ks$currency))))
unq_curr

cur.cnt <- ks %>% 
  inner_join(unq_ctry,by='country') %>% 
  inner_join(unq_curr,by='currency')

#USE THIS
cor(cur.cnt$country_code,cur.cnt$currency_code)
# 0.927% correlation - going to drop currency from analysis



country <- ks %>% group_by(country) %>% summarize(total=n(),
                                       succ_rate=sum(status=='successful')/total,
                                       avg_goal=mean(goal_usd),
                                       avg_pct_fund=mean(pct_funded),
                                       avg_bkrs=mean(backers_count),
                                       avg_plg=mean(avg_plg.bkr))

country

#start with this plot - show success rate vs country
#average success rate fairly well in-line with US

#compare mean of country group succ vs overall - use overall
?geom_hline()
mean(country$succ_rate)
sum(ks$status=='successful')/sum((ks$status=='successful'|ks$status=='failed'))

#USE THIS
#suspect we're seeing effect of outliers because country is not a strong factor itself
country %>%
  ggplot(aes(x=reorder(country,succ_rate),y=succ_rate))+
  geom_point(aes(size=total,col=avg_goal)) +
  geom_hline(yintercept = sum(ks$status=='successful')/sum((ks$status=='successful'|ks$status=='failed')))+
  ylim(0,1)+
  theme_linedraw() +
  labs(title='Country vs Success Rate',x='',y='Success Rate',
       size="Num Proj", color="Average Goal") 
#leave x=axis ordet the same and explore other variables

country %>%
  ggplot(aes(x=reorder(country,succ_rate),y=log(total))) +
  geom_point(aes(size=succ_rate,col=avg_goal)) +
  theme_linedraw() +
  labs(title='Country vs Number Projects',x='',y='log(Total projects)',
       size="Succ Rate", color="Average Goal") 
#plot highlights the high success rates are probably outliers

country %>%
  ggplot(aes(x=reorder(country,succ_rate),y=avg_plg)) +
  geom_point(aes(size=succ_rate,col=avg_goal)) +
  theme_linedraw() +
  labs(title='Country vs Number Projects',x='',y='Average Pledge',
       size="Succ Rate", color="Average Goal") 
#plot highlights the high success rates are probably outliers

country %>%
  ggplot(aes(x=reorder(country,succ_rate),y=avg_bkrs)) +
  geom_point(aes(size=succ_rate,col=avg_goal)) +
  theme_linedraw() +
  labs(title='Country vs Number Projects',x='',y='Average Num Backers',
       size="Succ Rate", color="Average Goal") 


# --- tried plotting as grid - too much info in size/color. reducing clutter... ----


count1 <-country %>%
  ggplot(aes(x=reorder(country,succ_rate),y=succ_rate))+
  geom_point() +
  geom_hline(yintercept = sum(ks$status=='successful')/sum((ks$status=='successful'|ks$status=='failed')))+
  ylim(0,1)+
  theme_linedraw() +
  labs(title='Country vs Success Rate',x='',y='Success Rate',
       size="Num Proj", color="Average Goal") 
#leave x=axis ordet the same and explore other variables

count2 <-country %>%
  ggplot(aes(x=reorder(country,succ_rate),y=log(total))) +
  geom_point() +
  theme_linedraw() +
  labs(title='Country vs Number Projects',x='',y='log(Total projects)',
       size="Succ Rate", color="Average Goal") 
#plot highlights the high success rates are probably outliers

count3 <-country %>%
  ggplot(aes(x=reorder(country,succ_rate),y=avg_plg)) +
  geom_hline(yintercept = mean(ks$avg_plg.bkr))+
  geom_point() +
  theme_linedraw() +
  labs(title='Country vs Average Pledge',x='',y='Average Pledge',
       size="Succ Rate", color="Average Goal") 
#plot highlights the high success rates are probably outliers

count4<-country %>%
  ggplot(aes(x=reorder(country,succ_rate),y=avg_bkrs)) +
  geom_hline(yintercept=mean(ks$backers_count)) +
  geom_point() +
  theme_linedraw() +
  labs(title='Country vs Average Backer Count',x='',y='Average Num Backers',
       size="Succ Rate", color="Average Goal") 

country %>%
  ggplot(aes(x=reorder(country,succ_rate),y=avg_goal)) +
  geom_hline(yintercept=mean(ks$goal_usd)) +
  geom_point() +
  theme_linedraw() +
  labs(title='Country vs Average Backer Count',x='',y='Average Num Backers',
       size="Succ Rate", color="Average Goal") 

#USE THIS
grid.arrange(count1,count2,count3,count4,nrow=2)
#the point is not to break down every facet of country, but show it is likely a confounding factor
#compare us to non-US


## ---- US vs Foreign ----

ks %>% 
  mutate(foriegn=ifelse(country=='US','US','Foriegn')) %>% 
  group_by(foriegn) %>%
  summarize(total=n(),
            succ_rate=sum(status=='successful')/total,
            avg_goal=mean(goal_usd),
            avg_bkrs=mean(backers_count),
            avg_plg=mean(avg_plg.bkr))
# foriegn  total succ_rate avg_goal avg_bkrs avg_plg
#   <chr>    <int>     <dbl>    <dbl>    <dbl>   <dbl>
# 1 Foriegn  63662     0.608   37545.     152.    73.0
# 2 US      138905     0.630   36650.     175.    76.2

#USE THIS
foreign <- ks %>% 
  mutate(foriegn=ifelse(country=='US','US','Foriegn')) %>% 
  group_by(status,foriegn) %>%
  summarize(total=n(),
            avg_goal=mean(goal_usd),
            avg_bkrs=mean(backers_count),
            avg_plg=mean(avg_plg.bkr))
#   status     foriegn total avg_goal avg_bkrs avg_plg
#   <chr>      <chr>   <int>    <dbl>    <dbl>   <dbl>
# 1 failed     Foriegn 24969   84054.     11.4    49.1
# 2 failed     US      51463   82829.     11.9    46.1
# 3 successful Foriegn 38693    7533.    243.     88.5
# 4 successful US      87442    9471.    271.     93.9



```


```{r Backer Stats & Pledge Amounts}

## backers_count -------------------------------------------------------------
# some projects have no backers - eliminate? [decided not to but will report in backer stats]
ks %>% count(backers_count==0)  
#  backers_count == 0      n
# 1              FALSE 186725
# 2               TRUE  12934
12934/(12934+186725) #~6.5% of projects have no backers

ks %>% group_by(status) %>% count(backers_count==0)  
#   status     `backers_count == 0`      n
#   <chr>      <lgl>                 <int>
# 1 failed     FALSE                 62294
# 2 failed     TRUE                  12934
# 3 successful FALSE                124431
12934/(62294+12934) #~17% of failed projects have no backers


#--- Pledge per backer stats ----

ks %>% group_by(status) %>% summarise(mean(avg_plg.bkr))
#   status     `mean(avg_plg.bkr)`
#   <chr>                    <dbl>
# 1 failed                    40.9
# 2 successful                85.3
ks %>% filter(backers_count>0) %>% group_by(status) %>% summarise(mean(avg_plg.bkr))
#   status     `mean(avg_plg.bkr)`
#   <chr>                    <dbl>
# 1 failed                    49.3
# 2 successful                85.3
##
#excluding backers brings average pledge per backer up by ~25%


#--- visualizing number of backers vs status

bkr1<- ks %>%
  ggplot(aes(x=status,y=log(backers_count)))+
  geom_boxplot(aes(fill=status),alpha=.6)+
  theme_linedraw() + 
  labs(title = 'Backer Count', x="", y= "log(Backer Count)") +
  theme(legend.position = "none")


  
bkr2 <-ks %>% filter(avg_plg.bkr<250) %>%
  ggplot(aes(x=status,y=avg_plg.bkr))+
  geom_boxplot(aes(fill=status),alpha=.6)+
  theme_linedraw() + 
  labs(title = 'Average Pledge (USD)', x="", y= "Avg Pledge") +
  theme(legend.position = "none")

grid.arrange(bkr1,bkr2,ncol=2)

#--- Scatter/pct_funded and backers ----


#pattern break at funding line probably has to do with shift in backer behavior
#tendency to make low pledge to follow a project, recieve updates and adjust in last 24 of campaign
#interesting that pledge per backer is HIGHER for projects near 100% funding

ks %>% filter(status=='successful') %>% count(pct_funded<1)
#   pct_funded < 1      n
# 1          FALSE 118585
# 2           TRUE   5846

#USE THIS
bkr3 <- ks %>%
  ggplot(aes(x=log(pct_funded),y=backers_count)) + 
  geom_point(aes(color=status),size=.1) +
  xlim(-10,10) +
  theme_linedraw() +
  labs(title='Backer Count Near Funding Goal',x='log(Percent Funded)',y='Backer Count')+
  theme(legend.position = 'none')

bkr4 <-ks %>%
  ggplot(aes(x=log(pct_funded),y=(avg_plg.bkr))) + 
  geom_point(aes(color=status),size=.1) +
  xlim(-10,10) +
  theme_linedraw() +
  labs(title='Average Pledge Near Funding Goal',x='log(Percent Funded)',y='Average Pledge') +
  theme(legend.position = 'none')

grid.arrange(bkr3,bkr4,nrow=2)


```


```{r Goal & Pct Pledged}

summary(ks$goal_usd)

#--- goal_usd --------------------------------------------------------------

#filter for 200k (max for successful)
goal1 <- ks %>%
  ggplot(aes(x=goal_usd)) +
  geom_density(aes(fill=status), alpha = .4) +
  theme_linedraw() +
  geom_vline(xintercept = 3400,color='steelblue4',size=.5) +
  geom_vline(xintercept = 8010,color='steelblue4',size=.5,linetype=2) +
  geom_vline(xintercept = 6733,color='brown4',size=.5) +
  geom_vline(xintercept = 23383,color='brown4',size=.5,linetype=2) +
  labs(y="",x='',title='Project Funding Goal (USD)') +
  theme(legend.position = c(.9,.75),
        legend.box.background = element_rect(color='black',size=1))

goal2 <- ks %>% filter(goal_usd<1e5) %>%
  ggplot(aes(x=goal_usd)) +
  geom_density(aes(fill=status), alpha = .4) +
  geom_vline(xintercept = 3400,color='steelblue4',size=1) +
  geom_vline(xintercept = 8010,color='steelblue4',size=1,linetype=2) +
  geom_vline(xintercept = 6733,color='brown4',size=1) +
  geom_vline(xintercept = 23383,color='brown4',size=1,linetype=2) +
  theme_linedraw() +
  labs(y="",x='') +
  theme(legend.position = 'none')

goal3 <- ks %>% filter(goal_usd<1e4) %>%
  ggplot(aes(x=goal_usd)) +
  geom_density(aes(fill=status), alpha = .4)+
  geom_vline(xintercept = 3400,color='steelblue4',size=1) +
  geom_vline(xintercept = 8010,color='steelblue4',size=1,linetype=2) +
  geom_vline(xintercept = 6733,color='brown4',size=1) +
  theme_linedraw() +
  labs(y="",x='Funding Goal') +
  theme(legend.position = 'none')

#USE THIS
grid.arrange(goal1,goal2,goal3,nrow=3)

#--- Box Plots/goal_usd

ks %>%
  ggplot(aes(x=fct_reorder(status,goal_usd),y=goal_usd)) +
  geom_violin(aes(fill=status)) +
  geom_boxplot(alpha=.5)
#long tail of unsuccessful projects masks
#plot on log scale instead

#USE THIS
ks %>%
  ggplot(aes(x=fct_reorder(status,goal_usd),y=log(goal_usd))) +
  geom_violin(aes(fill=status)) +
  geom_boxplot(alpha=.5) +
  theme_linedraw() +
  labs(x='',y='log(Prohect Funding Goal (USD))',title = 'Funding Goal')
# Overlap between IQRs, medians are veyr close (on log scale)
# success has low tail, failed has high

#USE THIS
ks %>%
  select(status,goal_usd) %>%
  split(.$status) %>%
  map(summary)
+   map(summary)
# $failed
#     status             goal_usd       
#  Length:75228       Min.   :     1.2  
#  Class :character   1st Qu.:  2300.0  
#  Mode  :character   Median :  6733.4  
#                     Mean   : 23383.9  
#                     3rd Qu.: 20000.0  
#                     Max.   :500000.0  
# 
# $successful
#     status             goal_usd     
#  Length:124431      Min.   :     1  
#  Class :character   1st Qu.:  1000  
#  Mode  :character   Median :  3400  
#                     Mean   :  8010  
#                     3rd Qu.:  9076  
#                     Max.   :500000  


#---------------------------------------------------------------------
#      pct_funded
#----------------------------------------------------------------------

  
#--- Density Plot/pct_funded

#USE THIS
ks %>% filter(pct_funded<5) %>%
  ggplot(aes(x=pct_funded*100)) +
  geom_density(aes(fill=status), alpha = .4) +
  theme_linedraw() +
  labs(x='',y='',title = 'Percent Funded') +
  theme(axis.text.y=element_blank())
#vast majority of funded projects do not exceed 200% of goal
#density scale is broken due to not showing full dataset - just hiding

#--- Histogram/pct_funded

ks %>% filter(status=='successful') %>%
  ggplot(aes(x=log(pct_funded))) + 
  geom_histogram(aes(),col='white') 

```


```{r Categories}
# --- broad (sub) categories ------------------------------------

# x = categories, y = goal, success rate
sub_cat <- ks %>% 
  group_by(sub_category) %>%
  summarise(pct_succ=sum(pct_funded>=1)/n(),
            avg_goal=mean(goal_usd),
            avg_bkrs=mean(backers_count),
            avg_plg=mean(avg_plg.bkr))
sub_cat

#USE THIS
sub_cat %>%
  ggplot(aes(x=reorder(sub_category, pct_succ))) +
  geom_point(aes(y=pct_succ,size=avg_bkrs,col=avg_goal)) +
  geom_hline(yintercept = sum(ks$status=='successful')/sum((ks$status=='successful'|ks$status=='failed')))+
  theme_linedraw() +
  scale_color_gradient(low='grey',high='firebrick4') +
  labs(x='',y='Percent Successful',title='Broad Category (aka SubCategory) Success') +
  theme(axis.text.x = element_text(angle=45,vjust=.65))




#--- by main category  ------------------------------------

main_cat <- ks %>% 
  group_by(main_category) %>%
  summarise(pct_succ=sum(pct_funded>=1)/n(),
            avg_goal=mean(goal_usd),
            avg_bkrs=mean(backers_count),
            avg_plg=mean(avg_plg.bkr))


main_cat

#USE THIS
main_cat %>%
  ggplot(aes(x=reorder(main_category, pct_succ))) +
  geom_point(aes(y=pct_succ,size=avg_bkrs,col=avg_goal)) +
  geom_hline(yintercept = sum(ks$status=='successful')/sum((ks$status=='successful'|ks$status=='failed')))+
  theme_linedraw() +
  scale_color_gradient(low='grey',high='firebrick4') +
  labs(x='',y='Percent Success',title='Broad Category (aka SubCategory) Success') +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.major.x = element_blank())

#USE THIS
main_cat %>% arrange(desc(pct_succ)) %>% top_n(10)
#    main_category    pct_succ avg_goal avg_bkrs avg_plg
#    <chr>               <dbl>    <dbl>    <dbl>   <dbl>
#  1 Product Design      0.957    9960.     437.    128.
#  2 Technology          0.945   12154.     435.    155.
#  3 Narrative Film      0.924   13475.     126.    118.
#  4 Documentary         0.901   18278.     207.    123.
#  5 Hardware            0.662   37553.     390.    153.
#  6 Camera Equipment    0.566   32510.     339.    185.
#  7 Sound               0.527   33418.     252.    166.
#  8 Robots              0.475   33931.     186.    142.
#  9 3D Printing         0.449   30139.     208.    147.
# 10 Wearables           0.431   39993.     273.    120.
main_cat %>% arrange(pct_succ) %>% top_n(-10)
#    main_category pct_succ avg_goal avg_bkrs avg_plg
#    <chr>            <dbl>    <dbl>    <dbl>   <dbl>
#  1 Candles          0.157    5534.    14.6     26.9
#  2 DIY              0.188   10100.    18.2     32.7
#  3 Bacon            0.229   18423.    37.1     28.2
#  4 Crochet          0.246    2454.     9.37    22.3
#  5 Printing         0.261    6811.    26.3     29.6
#  6 Embroidery       0.268    4675.    29.5     35.2
#  7 Hip-Hop          0.298   11394.    28.2     32.4
#  8 Poetry           0.413    4866.    31.2     33.8
#  9 Stationery       0.420    5568.    54.7     33.0
# 10 Digital Art      0.429    5848.    39.2     35.6



```


```{r Launch Timing}

#USE THIS
ks %>%
  group_by(launch_year) %>%
  summarize(ct_succ=sum(status=='successful'),
            ct_fail=sum(status=='failed'),
            pct_succ=ct_succ/n(),
            avg_bkr=mean(backers_count),
            avg_goal=mean(goal_usd),
            projects=n()) %>%
  ggplot(aes(x=launch_year,y=pct_succ,size=projects,col=avg_bkr)) +
  geom_point() +
  geom_hline(yintercept = sum(ks$status=='successful')/sum((ks$status=='successful'|ks$status=='failed')),linetype=3)+
  scale_x_continuous(limits=c(2009,2020),breaks=seq(2009,2020)) +
  ylim(c(0,1)) +
  theme(panel.grid.minor=element_blank()) +
  theme_linedraw() +
  labs(title='Launch Year Tends',x='Year',y='Percent success')
#interesting drop in 2014 then trending back up


#USE THIS
ks %>%
  group_by(launch_month) %>%
  summarize(ct_succ=sum(status=='successful'),
            ct_fail=sum(status=='failed'),
            pct_succ=ct_succ/n(),
            avg_bkr=mean(backers_count),
            avg_goal=mean(goal_usd),
            projects=n()) %>%
  ggplot(aes(x=launch_month,y=pct_succ,size=projects,col=avg_bkr)) +
  geom_point() +
  geom_hline(yintercept = sum(ks$status=='successful')/sum((ks$status=='successful'|ks$status=='failed')),linetype=3)+
  scale_x_continuous(limits=c(1,12),breaks=seq(1,12)) +
  ylim(c(0,1)) +
  theme_linedraw() +
  theme(panel.grid.minor=element_blank()) +
  labs(title='Launch Month Tends',x='Month',y='Percent success')

#USE THIS
ks %>%
  group_by(launch_dom) %>%
  summarize(ct_succ=sum(status=='successful'),
            ct_fail=sum(status=='failed'),
            pct_succ=ct_succ/n(),
            avg_bkr=mean(backers_count),
            avg_goal=mean(goal_usd),
            projects=n()) %>%
  ggplot(aes(x=launch_dom,y=pct_succ,size=projects,col=avg_bkr)) +
  geom_point() +
  geom_hline(yintercept = sum(ks$status=='successful')/sum((ks$status=='successful'|ks$status=='failed')),linetype=3)+
  scale_x_continuous(limits=c(1,31),breaks=seq(1,31)) +
  ylim(c(0,1)) +
  theme_linedraw() +
  theme(panel.grid.minor=element_blank()) +
  labs(title='Launch Day Tends - Day of Month',x='Day of Month',y='Percent success')

#USE THIS
ks %>%
  group_by(launch_dow) %>%
  summarize(ct_succ=sum(status=='successful'),
            ct_fail=sum(status=='failed'),
            pct_succ=ct_succ/n(),
            avg_bkr=mean(backers_count),
            avg_goal=mean(goal_usd),
            projects=n()) %>%
  ggplot(aes(x=launch_dow,y=pct_succ,size=projects,col=avg_bkr)) +
  geom_point() +
  geom_hline(yintercept = sum(ks$status=='successful')/sum((ks$status=='successful'|ks$status=='failed')),linetype=3)+
  scale_x_continuous(limits=c(1,7),breaks=seq(1,7)) +
  ylim(c(0,1)) +
  theme_linedraw() +
  theme(panel.grid.minor=element_blank()) +
  labs(title='Launch Day Tends - Day of Week',x='Day of week',y='Percent success')

#USE THIS
ks %>%
  group_by(launch_hour) %>%
  summarize(ct_succ=sum(status=='successful'),
            ct_fail=sum(status=='failed'),
            pct_succ=ct_succ/n(),
            avg_bkr=mean(backers_count),
            avg_goal=mean(goal_usd),
            projects=n()) %>%
  ggplot(aes(x=launch_hour,y=pct_succ,size=projects,col=avg_bkr)) +
  geom_point() +
  geom_hline(yintercept = sum(ks$status=='successful')/sum((ks$status=='successful'|ks$status=='failed')),linetype=3)+
  scale_x_continuous(sec.axis = sec_axis(~ .-5,name="Hour (EST)"),
                     limits=c(0,23),breaks=seq(0,23),) +
  ylim(c(0,1)) +
  theme_linedraw() +
  theme(panel.grid.minor=element_blank()) +
  labs(title='Launch Hour Trends',x='Hour (UTC)',y='Percent success')

?sec_axis

#--- Old Stuff ----

p_lm <- ks %>%
  group_by(launch_month) %>%
  summarize(ct_succ=sum(status=='successful'),
            ct_fail=sum(status=='failed'),
            pct_succ=ct_succ/n()) %>%
  ggplot(aes(x=launch_month,y=pct_succ)) +
  geom_point() +
  scale_x_continuous(limits=c(1,12),breaks=seq(1,12)) +
  ylim(c(0,1)) +
  theme(panel.grid.minor=element_blank())

p_ldom <- ks %>%
  group_by(launch_dom) %>%
  summarize(ct_succ=sum(status=='successful'),
            ct_fail=sum(status=='failed'),
            pct_succ=ct_succ/n()) %>%
  ggplot(aes(x=launch_dom,y=pct_succ)) +
  geom_point() +
  scale_x_continuous(limits=c(1,31),breaks=seq(1,31)) +
  ylim(c(0,1)) +
  theme(panel.grid.minor=element_blank())

p_ldow <- ks %>%
  group_by(launch_dow) %>%
  summarize(ct_succ=sum(status=='successful'),
            ct_fail=sum(status=='failed'),
            pct_succ=ct_succ/n()) %>%
  ggplot(aes(x=launch_dow,y=pct_succ)) +
  geom_point() +
  scale_x_continuous(limits=c(1,7),breaks=seq(1,7)) +
  ylim(c(0,1)) +
  theme(panel.grid.minor=element_blank())

p_lhour <- ks %>%
  group_by(launch_hour) %>%
  summarize(ct_succ=sum(status=='successful'),
            ct_fail=sum(status=='failed'),
            pct_succ=ct_succ/n()) %>%
  ggplot(aes(x=launch_hour,y=pct_succ)) +
  geom_point() +
  scale_x_continuous(limits=c(0,23),breaks=seq(0,23),
                     sec.axis = sec_axis(~.-5, name="EST")) +
  ylim(c(0,1)) +
  theme(panel.grid.minor=element_blank())

grid.arrange(p_lm,p_ldom,p_ldow,p_lhour, nrow=2)

```


```{r Deadline}
##############################################################################
##
## Deadline
##
##############################################################################


```


```{r Launch Timing}
##############################################################################
##
## Duration
##
##############################################################################


ks %>% group_by(status) %>% summarize(mean(duration),min(duration),max(duration),median(duration))
#   status     `mean(duration)` `min(duration)` `max(duration)` `median(duration)`
#   <chr>                 <dbl>           <int>           <int>              <dbl>
# 1 failed                 35.5               1              92                 30
# 2 successful             31.1               1              98                 30

ks %>%
  ggplot() +
  geom_density(aes(x=duration,fill=status),alpha=.4)

ks %>%
  ggplot()+
  geom_point(aes(x=duration,y=log(goal_usd),col=status),size=.01)

ks %>%
  ggplot() +
  geom_boxplot(aes(y=duration,x=status))
```


```{r Launch Timing}
##############################################################################
##
## Creator Experience
##
##############################################################################


#creators with more than one project

creator <- ks %>% 
  group_by(creator_id) %>% 
  summarise(total_proj=n(),
            succ_rate=sum(status=='successful')/total) %>%
  filter(total_proj>1)

creator %>%
  ggplot() +
  geom_point(aes(x=total,y=succ_rate))

#------------
creator2 <- ks %>% 
  group_by(creator_id,status) %>% 
  summarise(total_proj=n()) %>%
  filter(total_proj>1)

creator2
  
creator2 %>%
  ggplot() +
  geom_density(aes(x=total_proj,fill=status),alpha=.4) +
  xlim(0,20)

#--------------------
creator3 <- ks %>% 
  group_by(creator_id,status) %>% 
  summarise(total_proj=n())

creator3
  
creator3 %>%
  ggplot() +
  geom_density(aes(x=total_proj,fill=status),alpha=.4) +
  xlim(0,10)
# this is kinda interesting
#should be 0 to 1
# plot 1 proj vs more than one
```

## Build a model

```{r log_model}
summary(ks)

plot(ks)

##
## Notes ------------------------------------------------------
##


#backers_count, usd_pledged, and avg_plg.bkr are too interdependant. 
#is usd_pledged useful? it feels somewhat redundant with goal_usd, as being over_funded doesn't inform the answer of success any more than the combination of goal_usd and status do
#similarly, pct_funded does not seem useful

#ignoring city and country. you could psuedo-launch from anywhere and likely has confounding data.


##
## All Vars ------------------------------------------------------
##

#backers_count + country + usd_pledged + sub_category + main_category + goal_usd + duration + launch_month + launch_dom + +launch_dow + launch_hour + name_len + name_wrd

logit.overall = glm(status_binary ~backers_count + country + usd_pledged + sub_category + main_category + goal_usd + duration + launch_month + launch_dom + +launch_dow + launch_hour + name_len + name_wrd,
                    family = 'binomial',
                    data = ks)

scatter.smooth(logit.overall$fit,
               residuals(logit.overall, type = "deviance"),
               lpars = list(col = "red"),
               xlab = "Fitted Probabilities",
               ylab = "Deviance Residual Values",
               main = "Residual Plot for\nLogistic Regression of Admission Data")

exp(logit.overall$coefficients)

summary(logit.overall2)


##
## reduced vars ------------------------------------------------------
##


logit.overall2 = glm(status_binary ~ backers_count + sub_category + goal_usd + duration + launch_month + launch_dom + +launch_dow + launch_hour + name_len + name_wrd,
                    family = 'binomial',
                    data = ks)


scatter.smooth(logit.overall2$fit,
               residuals(logit.overall2, type = "deviance"),
               lpars = list(col = "red"),
               xlab = "Fitted Probabilities",
               ylab = "Deviance Residual Values",
               main = "Residual Plot for\nLogistic Regression of Admission Data")

exp(logit.overall2$coefficients)

summary(logit.overall2)

##
## elim insignificant values ------------------------------------------------------
##


logit.overall3 = glm(status_binary ~ backers_count + sub_category + goal_usd + duration + name_wrd,
                    family = 'binomial',
                    data = ks)


scatter.smooth(logit.overall3$fit,
               residuals(logit.overall3, type = "deviance"),
               lpars = list(col = "red"),
               xlab = "Fitted Probabilities",
               ylab = "Deviance Residual Values",
               main = "Residual Plot for\nLogistic Regression of Admission Data")

exp(logit.overall3$coefficients)

summary(logit.overall3)

#the deviance is the same for all 3 models
#is my data bad? too many outliers?
#would it be easier if I restricted to a smaller size
```


```{r log_model_reduced_goal}


ks.r <- ks %>% filter(goal_usd<50000)

logit.overall.r = glm(status_binary ~backers_count + country + usd_pledged + sub_category + main_category + goal_usd + duration + launch_month + launch_dom + +launch_dow + launch_hour + name_len + name_wrd,
                    family = 'binomial',
                    data = ks.r)

scatter.smooth(logit.overall.r$fit,
               residuals(logit.overall.r, type = "deviance"),
               lpars = list(col = "red"),
               xlab = "Fitted Probabilities",
               ylab = "Deviance Residual Values",
               main = "Residual Plot for logt.overall.r")

exp(logit.overall$coefficients)

summary(logit.overall2)



```
